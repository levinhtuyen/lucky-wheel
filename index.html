<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta name="description" content="SĂN SALE THÁNG 7 - ĐẶT 1 LẦN, HƯỞNG BỘI LẦN">
    <meta property="og:image" content="" />
    <meta property="og:url" content="" />
    <title>VÒNG XOAY SIÊU GIẢM</title>
    <link href="images/favicon.png" rel="icon">
    <link rel="stylesheet" href="css/typo/typo.css" />
    <link rel="stylesheet" href="css/hc-canvas-luckwheel.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js"></script>
    <style>
      .bg-ref {
          background-image: url('images/ref-lucky-wheel.jpg');
          background-position: center center;
          background-repeat: no-repeat;
          background-attachment: fixed;
          background-size: cover;
          background-color: #464646;
      }
      .hc-luckywheel {
        position:fixed;
        top: 50%;
        left: 50%;
        margin-top: -100px;
        margin-left: -220px;
        width: 400px; /*Change this when change size*/
        height: 400px; /*Change this when change size*/
        border-radius: 50%;
        border: 16px solid #e44025;
        box-shadow: 0 2px 3px #333, 0 0 2px #000;
      }
      .wrapper {
        width: 100%;
        height: 100%
      }
      .g2j-basic-modal__section {
        position: relative;
        top: 50%;
        -webkit-transform: translateY(-50%);
        -ms-transform: translateY(-50%);
        transform: translateY(-50%);
        left: 0;
        right: 0;
        margin: 0 auto;
        z-index: 10;
        min-height: 100px;
        width: calc(100% - 32px);
        background: #fff;
        border-radius: 20px;
      }
      .g2j-basic-modal {
          position: fixed;
          left: 0;
          top: 0;
          height: 100%;
          width: 100%;
          z-index: 20;
          cursor: default;
          padding-bottom: 51px;
      }
      .g2j-basic-modal__bg {
          position: absolute;
          background: rgba(0,0,0,.5);
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          cursor: pointer;
      }
      .g2j-direct-app-notice-modal .section-head {
          position: absolute;
          top: 0;
          right: 0;
          z-index: 10;
          width: auto;
          border-bottom: none;
      }
      .g2j-basic-modal__section__head__title {
          font-size: 2.5rem;
          margin-right: 26px;
      }
      .g2j-basic-modal__section__head__close-btn {
          display: flex;
          flex: 0 0 48px;
          width: 48px;
          height: 48px;
          align-items: center;
          justify-content: center;
          margin-left: auto;
          cursor: pointer;
          margin-right: 0px;
          font-size: 2.5rem;
      }
      .g2j-basic-modal__section__head__close-btn:focus {
        border: none;
      }
      .limit-text {
        width: 180px;
        max-height: 24px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        text-align: left;
      }
      .limit-line {
        width: 185px;
        overflow: hidden;
        text-overflow: ellipsis;
        line-height: 1.2;
        -webkit-line-clamp: 2;
        display: -webkit-box;
        -webkit-box-orient: vertical;
      }
      .g2j-basic-modal__section__head__close-btn img {
        width: 20px;
        height: 20px;
      }
      .detail-btn {
        display: flex;
        height: 28px;
        align-items: center;
        background: #ff6400;
        border-radius: 28px;
        border: none;
        box-shadow: -2px 8px 16px rgb(255 100 0 / 20%);
        color: #fff;
        font-size: 14px;
        font-weight: 700;
        padding: 4px 24px;
        cursor: pointer;
        white-space: nowrap;
      }
      .detail-btn a{
        color: #fff;
      }
      .g2j-direct-app-notice-modal .modal-section {
        top: 50%;
          position: relative;
          border-radius: 16px;
          overflow: hidden;
          width: calc(100% - 32px);
          max-width: 500px;
          min-height: auto;
      }
      .g2j-basic-modal__section__body {
          overflow: hidden;
      }
      .g2j-direct-app-notice-modal .section-body {
          background: #fff5ee;
          min-height: 100%;
          padding: 32px 16px;
      }
      .g2j-direct-app-notice-modal__img-outer {
          text-align: center;
          margin-bottom: 8px;
      }
      .g2j-direct-app-notice-modal__content--title {
          text-align: center;
          font-weight: 700;
          font-size: 18px;
          color: #fd6500;
      }
      .g2j-direct-app-notice-modal__content--first {
          text-align: center;
          margin: 20px 17% 16px;
      }

      .g2j-direct-app-notice-modal__content--second{
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .g2j-direct-app-notice-modal__content--second img{
        display: flex;
        align-items: center;
        justify-content: center;
        max-width: 250px;
        height: auto;
      }
      .g2j-direct-app-notice-modal__container-group {
          display: flex;
          align-items: center;
          justify-content: center;
          margin-top: 16px;
      }
      .g2j-direct-app-notice-modal__container-group img {
          margin-right: 8px;
      }
      .g2j-direct-app-notice-modal__btn-group {
          display: flex;
          align-items: center;
          justify-content: center;
          flex-direction: column;
      }
      .g2j-direct-app-notice-modal__btn-item {
          position: relative;
          margin-bottom: 8px;
          flex: 0 0 50%;
          max-width: 120px;
          border-radius: 8px;
          overflow: hidden;
      }
      .g2j-direct-app-notice-modal__btn-item:before {
          position: absolute;
          content: "";
          display: block;
          background: #fff;
          opacity: 0;
          width: 100%;
          height: 100%;
          left: 0;
          top: 0;
      }
      .g2j-direct-app-notice-modal__btn-item img {
          vertical-align: bottom;
      }
      .g2j-direct-app-notice-modal__container-group img {
          margin-right: 8px;
      }
      @media only screen and (max-width: 1025px) {
        .hc-luckywheel {
            position:fixed;
            top: 50%;
            left: 50%;
            margin-top: -110px;
            margin-left: -130px;
            width: 365px;
            height: 365px;
            border-radius: 50%;
            border: 16px solid #e44025;
            box-shadow: 0 2px 3px #333, 0 0 2px #000;
          }
        .hc-luckywheel-item span {
        /* width: 50px; */
          position: relative;
          display: block;
          /* padding-top: 20px; */
          width: 100px;
          margin: 0 auto;
          text-align: center;
          transform-origin: 50% 250px;
          text-transform: uppercase;
          -webkit-transform-origin: 50% 250px;
          -ms-transform-origin: 50% 250px;
          transform-origin: 50% 180px;
          }
        .hc-luckywheel-btn {
            position: absolute;
            left: 147px;
            top: 139px;
            width: 75px;
            height: 75px;
        }
        .bg-ref {
          background-image: url('images/ref-lucky-wheel.jpg');
          background-position: center center;
          background-repeat: no-repeat;
          background-attachment: fixed;
          background-size: cover;
          background-color: #464646;
        }
      }
      @media only screen and (max-width: 769px) {
        .hc-luckywheel {
            position:fixed;
            top: 50%;
            left: 50%;
            margin-top: -125px;
            margin-left: -190px;
            width: 350px; /*Change this when change size*/
            height: 350px; /*Change this when change size*/
            border-radius: 50%;
            border: 16px solid #e44025;
            box-shadow: 0 2px 3px #333, 0 0 2px #000;
          }
        .hc-luckywheel-item span {
          /* width: 50px; */
          position: relative;
          display: block;
          /* padding-top: 20px; */
          width: 100px;
          margin: 0 auto;
          text-align: center;
          transform-origin: 50% 250px;
          text-transform: uppercase;
          -webkit-transform-origin: 50% 250px;
          -ms-transform-origin: 50% 250px;
          transform-origin: 50% 172px;
        }
        .hc-luckywheel-btn {
          position: absolute;
          left: 143px;
          top: 131px;
          width: 70px;
          height: 70px;
        }
        .hc-luckywheel-item img {
            position: relative;
            top: 0px;
            left: 0px;
            width: 90px;
            height: 90px;
        }
        .bg {
            background-image: url('images/luckywheel-02-tablet.jpg');
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-size: cover;
            background-color: #464646;
        }
        .bg-ref {
          background-image: url('images/ref-lucky-wheel.jpg');
          background-position: center center;
          background-repeat: no-repeat;
          background-attachment: fixed;
          background-size: cover;
          background-color: #464646;
        }
      }
      @media only screen and (max-width: 600px) {
        .hc-luckywheel {
          width: 350px;
          height: 350px;
          top: 10%;
          left: 18%;
          margin:0;
          width: 300px;
          height: 300px;
          border: 12px solid #e44025;
        }
        .hc-luckywheel-item img {
          top: -5px;
          width: 50px;
          height: 50px;
        }
        .hc-luckywheel-item span {
          transform-origin: 50% 150px;
        }
        .hc-luckywheel-item span p {
          font-size:12px; 
        }
        .hc-luckywheel-btn {
          left: 110px;
          top: 100px;
          width: 82px;
          height: 80px;
          line-height: 36px;
          text-align: center;
          font-size: 12px;
        }
        .hc-luckywheel-btn::after {
          left: 3px;
          top: -20px;
          width: 0;
          height: 0;
          overflow: hidden;
          border-width: 15px;
        }
        .swal2-title {
          font-size: 14px;
        }
        .hc-luckywheel-item span {
          font-size: 12px;
          width: 80px;
        }
        .hc-luckywheel-item img {
          position: relative;
          top: 7px;
          left: 0px;
          width: 67px;
          height: 66px;
        } /*Change this when change size*/
      }
      @media only screen and (max-width: 426px) {
        .hc-luckywheel {
          top: 37%;
          left: 12%;
          margin:0;
          width: 300px;
          height: 300px;
          border: 12px solid #e44025;
          
        }
        .hc-luckywheel-item span {
          font-size: 10px;
        }
        .hc-luckywheel-btn {
          left: 110px;
          top: 100px;
          width: 85px;
          height: 80px;
          line-height: 36px;
          text-align: center;
          font-size: 12px;
        }
        .bg {
          background-image: url('images/luckywheel-02-mobile.jpg');
          background-position: center center;
          background-repeat: no-repeat;
          background-attachment: fixed;
          background-size: cover;
          background-color: #464646;
        }
        .bg-ref {
          background-image: url('images/ref-lucky-wheel_mobile.jpg');
          background-position: center center;
          background-repeat: no-repeat;
          background-attachment: fixed;
          background-size: cover;
          background-color: #464646;
        }
      }
      @media only screen and (max-width: 376px){
        .hc-luckywheel {
          width: 300px;
          height: 300px;
          left: 7%;
        }
        .hc-luckywheel-btn {
          left: 110px;
          top: 100px;
          width: 82px;
          height: 80px;
          line-height: 36px;
          text-align: center;
          font-size: 12px;
        }
       
        
      }   
      @media only screen and (max-width: 321px){
        .hc-luckywheel {
          width: 250px;
          height: 250px;
          left: 6.5%;
        }
        .hc-luckywheel-btn {
            left: 93px;
            top: 82px;
            width: 67px;
            height: 67px;
            line-height: 36px;
            text-align: center;
            font-size: 12px;
        }
        .hc-luckywheel-item span {
          transform-origin: 50% 125px;
        }
      }  
      
    </style>
  </head>
  <body class="bg" id="myModal" style="height: 100vh !important" >
    <div class="wrapper typo" id="wrapper">
      <section id="luckywheel" class="hc-luckywheel">
        <div class="hc-luckywheel-container">
          <canvas class="hc-luckywheel-canvas" width="500px" height="500px"
            >Vòng Xoay May Mắn</canvas
          >
        </div>
        <a class="hc-luckywheel-btn" href="javascript:;">
          <img src="images/luckywheel-09.png" />
        </a>
      </section>
    </div>
  
    
    <script>
    const header = parseQueryString()
    const headerFormDataGet = {
        'Authorization' : header?.Token,
        'Device-Encode' : header?.DeviceEncode,
        'Secret-Code': header?.SecretCode
    }
    axios.defaults.headers =  headerFormDataGet
    function parseQueryString() {
        let query = window.location.search;
        if(!query){
          return
        }
        var urlparts= query.split('?');
        var vars = urlparts[1]?.split("&");
        var params = {};
        
        for (var i = 0; i < vars?.length; i++) {
            var pair = vars[i].split("=");
            var key = decodeURIComponent(pair.shift());
            var value = decodeURIComponent(pair.join("="));
            // If first entry with this name
            if (typeof params[key] === "undefined") {
            params[key] = value;
            // If second entry with this name
            } else if (typeof params[key] === "string") {
            var arr = [params[key], value];
            params[key] = arr;
            // If third or later entry with this name
            } else {
            params[key].push(value);
            }
        }
        return params;
    }
    async function checkDataFromApi () {
        var result = await axios.get("https://staging-api.go2joy.vn/api/v3/mobile/reward/checkUserConditionLuckyWheel", {name: "data"}).then(function (response) {
            console.log(response.data.data)
            return response.data.data
        })
        return result
    }
    async function getDataFromApi () {
        if(!header){
          axios.defaults.headers = {
            'Authorization' : 'Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJsYXJhdmVsLWp3dCIsInN1YiI6IntcInNjb3BlXCI6XCJtb2JpbGVcIixcImFwcFVzZXJTblwiOjQwNDM2NyxcInJlYWRBZ3JlZVBvbGljeVwiOjF9IiwiaWF0IjoxNjU3MDcyNjgwLCJleHAiOjE2ODA3NDYyODB9.OZ3Y4BPlrSDbo9KtT4l8jRPAWGsEwYoAK_gjWTYfOJw',
            'Device-Encode' : '93b5a7a8702a6e75b3e2bbc1b3b2fb8c',
            'Secret-Code': '7bc79fa5139b8266e12993014bb68911'
          }
        }
        var result = await axios.get("https://staging-api.go2joy.vn/api/v3/mobile/reward/getPromotionLuckyWheel", {name: "data"}).then(function (response) {
            console.log(response.data.data)
            return response.data.data
        })
        return result
    }
    async function randomIndex(prizes){
      const check = checkDataFromApi()
      var isPercentage = true
        prizeIndex = await axios.get("https://staging-api.go2joy.vn/api/v3/mobile/reward/randomPromotionLuckyWheel", {name: "data"}).then(function (response) {
            console.log('response randomPromotionLuckyWheel', response.data.data)
            return response.data.data
        })
        var index = prizes.findIndex(item => item.sn === prizeIndex);
        console.log('index',index)
        return index
    };
    document.addEventListener(
        "DOMContentLoaded",
        async function() {
        var prizes = await getDataFromApi();
        hcLuckywheel.init({
            id: "luckywheel",
            config: function(callback) {
            callback &&
                callback(prizes);
            },
            mode : "both",
            getPrize: async function(callback) {
            var rand = await randomIndex(prizes);
            var chances = rand;
            callback && callback([rand, chances]);
            },
            gotBack: function(data) {
            if(data == null){ 
                document.getElementById("myModal").innerHTML += `<div class="modal" id="myModal-down-app">
                <div class="g2j-basic-modal g2j-direct-app-notice-modal">
                    <div class="g2j-basic-modal__bg modal-bg"> </div>
                    <div class="g2j-basic-modal__section modal-section">
                    <div class="g2j-basic-modal__section__head section-head">
                        <div class="g2j-basic-modal__section__head__title head-title"> </div>
                        <div class="g2j-basic-modal__section__head__close-btn close" >
                                <span class="close " data-dismiss="modal">
                                
                                </span>
                        </div>
                        </div>
                    <div class="g2j-basic-modal__section__body section-body scroll-bar-custom">

                        <h2 class="g2j-direct-app-notice-modal__content--title">Chương trình đã kết thúc hoặc bạn đã chơi rồi</h2>
                        <div class="g2j-direct-app-notice-modal__content--second"> Tải Ứng dụng Go2Joy tại đây</div>
                        <div class="g2j-direct-app-notice-modal__container-group">
                        <img src="https://go2joy.vn/image/qrcode.svg" alt="QR Go2Joy App" height="85px" width="85px" />
                        <div class="g2j-direct-app-notice-modal__btn-group">
                            
                        </div>
                        </div>
                    </div>
                    </div>
                </div>
            </div>`;
            } else if (data.text == 'Chúc bạn may mắn lần sau'){
                console.log('Bạn không trúng thưởng')
                document.getElementById("myModal").innerHTML += `<div class="modal" id="myModal-down-app">
                <div class="g2j-basic-modal g2j-direct-app-notice-modal">
                    <div class="g2j-basic-modal__bg modal-bg"> </div>
                    <div class="g2j-basic-modal__section modal-section">
                    <div class="g2j-basic-modal__section__head section-head">
                        <div class="g2j-basic-modal__section__head__title head-title"> </div>
                        <div class="g2j-basic-modal__section__head__close-btn close" >
                                <span class="close " data-dismiss="modal">
                                
                                </span>
                        </div>
                        </div>
                    <div class="g2j-basic-modal__section__body section-body scroll-bar-custom">

                        <h2 class="g2j-direct-app-notice-modal__content--title">${data.text}</h2>
                        <div class="g2j-direct-app-notice-modal__content--second"> 
                          <img src="https://go2joy.s3.ap-southeast-1.amazonaws.com${data.img}" />
                        </div>
                          <div class="g2j-direct-app-notice-modal__btn-group">
                            <div class="detail-btn"><a href="/back">Back</a></div>      
                          </div>
                        </div>

                      </div>
                      
                    </div>
                </div>
            </div>`;
            } else{
                console.log('Đã trúng giải')
                
                document.getElementById("myModal").innerHTML += `<div class="modal" id="myModal-down-app">
                <div class="g2j-basic-modal g2j-direct-app-notice-modal">
                    <div class="g2j-basic-modal__bg modal-bg"> </div>
                    <div class="g2j-basic-modal__section modal-section">
                    <div class="g2j-basic-modal__section__head section-head">
                        <div class="g2j-basic-modal__section__head__title head-title"> </div>
                          <div class="g2j-basic-modal__section__head__close-btn close" >
                            <span class="close " data-dismiss="modal">
                            </span>
                          </div>
                        </div>
                        <div class="g2j-basic-modal__section__body section-body scroll-bar-custom">
                            <h2 class="g2j-direct-app-notice-modal__content--title">${data.text}</h2>
                            <div class="g2j-direct-app-notice-modal__content--second"> 
                              <img src="https://go2joy.s3.ap-southeast-1.amazonaws.com${data.img}" />
                            </div>
                            <div class="g2j-direct-app-notice-modal__btn-group">
                              <div class="detail-btn"><a href="/back">Back</a></div>    
                            </div>
                          </div>
                        </div>
                    </div>
                    
                </div>
            </div>`;
            }
            const dialog = document.querySelector('.g2j-basic-modal');
            const closeButton = document.querySelector('.close');
                closeButton.addEventListener('click', () => {
                    dialog.style.display = 'none';
                    
                });
            const bgRef = document.querySelector('.bg')
            const wrapper = document.querySelector('.wrapper')
            wrapper.style.display ='none'
            bgRef.classList.add("bg-ref");
            }
        });
        },
        false
    );
    </script>
  </body>
  <script src="js/hc-canvas-luckwheel.js"></script>
</html>
